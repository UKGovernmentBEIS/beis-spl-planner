{% from "summary-list/macro.njk" import govukSummaryList %}
{% from "inset-text/macro.njk" import govukInsetText %}
{% from "warning-text/macro.njk" import govukWarningText %}
{% from "../components/leave-block-summary.njk" import leaveBlockSummary %}
{% from "../components/secondary-notice.njk" import secondaryNotice %}
{% from "../components/primary-notice.njk" import primaryNotice %}

{% set primaryLeaveType = (data | primaryLeaveType) %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">
    <h1 class="govuk-heading-xl print-show">
    Leave summary
    </h1>
    <p>
      This is a summary of your leave plan.
      It shows your leave weeks, when you need to notify your employer and how you can apply.
    </p>
    <p>
      All start dates are on a Monday and end dates are a Sunday. You can choose a different day of the week to start your leave when you give notice.
    </p>

    {{ govukSummaryList({
      rows: [
        {
          key: {
            text: "Placement date" if data | isAdoption else "Baby is due"
          },
          value: {
            text: data | startDay | formatForDisplay
          }
        }
      ]
    }) }}

    <h2 class="govuk-heading-l">
      {{ data | primaryName | capitalize }}’s leave dates
    </h2>
    <h3 class="govuk-heading-m">
      {{ primaryLeaveType | capitalize }} Leave
    </h3>

    {{ leaveBlockSummary({
      name: (primaryLeaveType | capitalize) + " Leave",
      block: leaveBlocks.primary.initial,
      data: data,
      notify: {
        date: data | startDay | startOfWeek | offsetWeeks(-15),
        explanation: "15 weeks before " + data | startDateName
      }
    }) }}

    <h4 class="govuk-heading-s">
      How to give notice
    </h4>
    <p>
      Tell your employer when the {{ "child will be placed with you" if data | isAdoption else "baby is due" }} and when you want to start your {{ primaryLeaveType | capitalize }} Leave.
      Your employer can ask for this in writing.
      Your employer must write to you within 28 days confirming your start and end dates.
    </p>

    {% if leaveBlocks.primary.spl | length === 0 and leaveBlocks.secondary.spl | length > 0 %}
      <h4 class="govuk-heading-s">
        Ending your {{ primaryLeaveType | capitalize }} Leave or Pay
      </h4>
      <p>
        You must end your {{ primaryLeaveType | capitalize }} Leave or pay to create Shared Parental Leave or Pay.
        You can do this by returning to work or curtailing it (committing to end it before you return to work).
      </p>
      <p>
        You must also confirm that you’re not taking Shared Parental Leave and Pay and consent to your partner taking it.
      </p>
      <p>
        You can do all of this by submitting the {{ primaryLeaveType | capitalize }} Leave curtailment and Shared Parental Leave consent form
        to your employer at least 8 weeks before your partner wants to start Shared Parental Leave.
      </p>
      {{ primaryNotice ({
        data: data
      }) }}
    {% endif %}

    <h4 class="govuk-heading-s">
      Changing your plans
    </h4>
    <p>
      You must give 28 days’ notice to your employer if you want to change your {{ primaryLeaveType | capitalize }} Leave dates.
    </p>

    {% if leaveBlocks.primary.spl.length > 0 %}
      <h3 class="govuk-heading-m">
        Shared Parental Leave ({{ data | primaryName }})
      </h3>
      {% for block in leaveBlocks.primary.spl %}
        {{ leaveBlockSummary({
          name: "Block " + loop.index,
          block: block,
          data: data,
          notify: {
            date: data | startDay | startOfWeek | offsetWeeks(block.start) | offsetWeeks(-8),
            explanation: "8 weeks before block starts",
            asterisk: loop.length > 1
          }
        }) }}
      {% endfor %}
      {% if leaveBlocks.primary.spl.length > 1 %}
        <p>
          * You can notify your employer of multiple blocks of Shared Parental Leave at the same time if your employer agrees.
        </p>
      {% endif %}

      <h4 class="govuk-heading-s">
        How to give notice
      </h4>
      <p>
        Complete the {{ data | primaryName }}’s Shared Parental Leave and Pay notice form and submit it to the {{ data | primaryName }}’s employer 8 weeks before they want to start Shared Parental Leave.
      </p>

      {{ primaryNotice ({
        data: data
      }) }}

      <h4 class="govuk-heading-s">
        Changing your plans
      </h4>
      <p>
        After you give notice you have two weeks to agree your Shared Parental Leave dates with your employer.
      </p>
      <p>
        To change your dates after this you must give notice again 8 weeks before your first block of Shared Parental Leave starts.
      </p>
    {% endif %}

    {% if leaveBlocks.secondary.initial or leaveBlocks.secondary.spl.length %}
      <h2 class="govuk-heading-l">
        {{ data | secondaryName | capitalize }}’s leave dates
      </h2>
      {% if leaveBlocks.secondary.initial %}
        <h3 class="govuk-heading-m">
          Paternity Leave
        </h3>

        {% if data | isAdoption %}
          <p>Paternity Leave can start the day your child is placed with you, or within 8 weeks after.</p>
        {% else %}
          <p>Paternity Leave can start once the child is born, or within 8 weeks of the child’s birth.</p>
        {% endif %}

        {{ leaveBlockSummary({
          name: "Paternity Leave",
          block: leaveBlocks.secondary.initial,
          data: data,
          notify: {
            date: data | startDay | startOfWeek | offsetWeeks(-15),
            explanation: "15 weeks before due date"
          }
        }) }}

        <h4 class="govuk-heading-s">
          How to give notice
        </h4>
        <p>
          Use
          <a href="https://public-online.hmrc.gov.uk/lc/content/xfaforms/profiles/forms.html?contentRoot=repository:///Applications/PersonalTax_iForms/1.0/SC3&template=SC3.xdp" target="_blank">form SC3</a>
          to apply to your employer for Statutory Paternity Pay (SPP) and Leave.
        </p>

        <h4 class="govuk-heading-s">
          Changing your plans
        </h4>
        <p>
          You must give 28 days’ notice to your employer if you want to change your Paternity Leave dates.
        </p>
      {% endif %}

      {% if leaveBlocks.secondary.spl.length %}
        <h3 class="govuk-heading-m">
          Shared Parental Leave ({{ data | secondaryName }})
        </h3>
        {% for block in leaveBlocks.secondary.spl %}
          {{ leaveBlockSummary({
            name: "Block " + loop.index,
            block: block,
            data: data,
            notify: {
              date: data | startDay | startOfWeek | offsetWeeks(block.start) | offsetWeeks(-8),
              explanation: "8 weeks before block starts",
              asterisk: loop.length > 1
            }
          }) }}
        {% endfor %}
        {% if leaveBlocks.primary.spl.length > 1 %}
          <p>
            * You can notify your employer of multiple blocks of Shared Parental Leave at the same time if your employer agrees.
          </p>
        {% endif %}

        <h4 class="govuk-heading-s">
          How to give notice
        </h4>
        <p>
          Complete the {{ data | secondaryName }}’s Shared Parental Leave and Pay notice form and submit it to the {{ data | secondaryName }}’s employer 8 weeks before they want to start Shared Parental Leave.
        </p>

        {{ secondaryNotice ({
          data: data
        }) }}

        {% if leaveBlocks.primary.spl | length === 0 and leaveBlocks.secondary.spl | length > 0 %}
          {% set formUrl %}
            {% if data | isBirth -%}
              Maternity_Entitlement_Curtailment.docx
            {%- elif data | isAdoption -%}
              Adoption_Entitlement_Curtailment.docx
            {%- else -%}
              Parental_Order_Parent_Entitlement_Curtailment.docx
            {%- endif %}
          {% endset %}
          {% set curtailmentWarningHtml %}
            The {{ data | primaryName }} must end their {{ primaryLeaveType | capitalize }} Leave and Pay by returning to work or submitting a curtailment notice.
            They must also give consent for the partner to take Shared Parental Leave or Pay.
            {% set href = "/forms/" + formUrl %}
            They can do both by submitting the <a href="{{ href }}">{{ primaryLeaveType | capitalize }} curtailment and SPL consent form</a>.
          {% endset %}
          {{ govukWarningText({
            html: curtailmentWarningHtml,
            iconFallBackText: "Warning"
          }) }}
        {% endif %}

        <h4 class="govuk-heading-s">
          Changing your plans
        </h4>
        <p>
          After you give notice you have two weeks to agree your Shared Parental Leave dates with your employer.
        </p>
        <p>
          To change you dates after this you must give notice again 8 weeks before your first block of Shared Parental Leave starts.
        </p>
      {% endif %}
    {% endif %}

    {{ pushToGoogleAnalyticsDataLayer("primaryBlockleaves_count", 1, "primaryBlockleaves") }}

    {% set partnerInitialLeaveCount = 1 if leaveBlocks.secondary.initial else 0 %}
    {{ pushToGoogleAnalyticsDataLayer("partnerBlockleaves_count", partnerInitialLeaveCount, "partnersBlockleaves") }}

    {% set splLeaveCount = leaveBlocks.primary.spl.length + leaveBlocks.secondary.spl.length %}
    {{ pushToGoogleAnalyticsDataLayer("splBlockleaves_count", splLeaveCount, "splBlockleaves") }}

    {% set totalBlockCount = 1 + partnerInitialLeaveCount + splLeaveCount %}
    {{ pushToGoogleAnalyticsDataLayer("totalBlockleaves_count", totalBlockCount, "totalBlockleaves") }}
  </div>
</div>
